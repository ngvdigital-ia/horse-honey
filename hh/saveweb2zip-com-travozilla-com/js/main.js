const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/parallax-Bnwz7UnT.css","assets/index-DdztCYrB.css","assets/animations-interactions-CoalJegd.css","assets/debug-window-B-fwM3yK.css"])))=>i.map(i=>d[i]);
import{e as elVisible,w as waitForVisible,c as check_cookie,g as get_cookie,s as set_cookie,_ as __vitePreload}from"./utils-B03TCBFH.js";import{t as trackEvent,a as trackPurchase,b as trackCustomEvent,T as TrackingListeners,w as watchBuyButtons,s as startTracking,c as sendPageViewEvent,d as sendPageExitEvent,e as sendPageScrollEvent,f as sendClickEvent,g as sendFunnelNodeEvent}from"./plugin-player.js";let lastListenerInfo=new Array;function addCustomEventListener(t,n,i){t&&(t.addEventListener(n,i),lastListenerInfo.push({el:t,e:n}))}if(HTMLAnchorElement.prototype.realAddEventListener=HTMLAnchorElement.prototype.addEventListener,window.dc===1){let t=document.querySelector("body");t.style.webkitUserSelect="none",t.style.MozUserSelect="none",t.style.msUserSelect="none",t.style.userSelect="none",document.addEventListener("contextmenu",function(n){n.preventDefault()}),document.onkeydown=function(n){return n.keyCode!==123&&(!n.ctrlKey||!n.shiftKey||n.keyCode!==73)&&(!n.ctrlKey||!n.shiftKey||n.keyCode!==67)&&(!n.ctrlKey||!n.shiftKey||n.keyCode!==74)&&(!n.ctrlKey||n.keyCode!==85)&&void 0}}function processCustomCSS(){const t=document.querySelectorAll("[data-custom-css]");if(t.length===0)return;let n=document.getElementById("ef-custom-css");n||(n=document.createElement("style"),n.id="ef-custom-css",document.head.appendChild(n));let i=[],o=0;t.forEach(a=>{let r=a.getAttribute("data-custom-css");if(!r)return;r=r.replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&"),r=r.replace(/\n/g," ").replace(/\s+/g," ").trim();let d=a.id;d||(d="ef-custom-id-"+o++,a.id=d);const c=r.replace(/selector\s*\{/g,`#${d} {`);i.push(c)}),i.length>0&&(n.textContent=i.join(`

`))}(()=>{function t(n){let i=window.location.href,o=new URL(i);return o.searchParams.set("lzid",n),fetch(o.toString()).then(a=>a.text()).then(a=>{let r=document.getElementById(n),d=document.createElement("lazy-load-container");return d.id=n,d.innerHTML=a,r&&Array.from(r.attributes).forEach(c=>{(c.name.startsWith("data-")||c.name==="style")&&d.setAttribute(c.name,c.value)}),r.replaceWith(d),d.querySelectorAll("script").forEach(c=>{const l=document.createElement("script");c.src?l.src=c.src:l.textContent=c.textContent,Array.from(c.attributes).forEach(u=>{l.setAttribute(u.name,u.value)}),console.log("newScript",l),c.parentNode.replaceChild(l,c)}),a})}window.efLoadLazyContainer=function(n,i=!1){let o=document.getElementById(n);return i||o&&o.hasAttribute("data-reloadable")?t(n):o&&o.hasAttribute("data-loaded")?(console.log("Container already loaded and not reloadable:",n),Promise.resolve()):t(n).then(a=>{let r=document.getElementById(n);return r&&!r.hasAttribute("data-reloadable")&&r.setAttribute("data-loaded","true"),a})},document.querySelectorAll("lazy-load-container").forEach(n=>{let i=parseInt(n.getAttribute("data-delay")||0),o=n.getAttribute("data-load-on-approach"),a=o==="1",r=n.hasAttribute("data-programmatic-load"),d=n.hasAttribute("data-reloadable"),c=n.getAttribute("id");if(console.log("Container:",c,"delay:",i,"loadOnApproach:",o,"parsed:",a,"programmaticLoad:",r,"reloadable:",d),r)return void console.log("Skipping auto-load for programmatic container:",c);let l=!1;const u=()=>{l&&!d||(l=!0,t(c).then(()=>{if(d)l=!1;else{let s=document.getElementById(c);s&&s.setAttribute("data-loaded","true")}}))};if(i>0&&setTimeout(u,i),a&&"IntersectionObserver"in window){console.log("Setting up observer for:",c);const s=window.innerHeight,p=new IntersectionObserver(g=>{g.forEach(w=>{w.isIntersecting&&(console.log("load on approach",c),u(),d||p.disconnect())})},{rootMargin:`0px 0px ${s}px 0px`});p.observe(n)}})})(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",processCustomCSS):processCustomCSS();const customCssObserver=new MutationObserver(t=>{let n=!1;t.forEach(i=>{i.addedNodes.forEach(o=>{o.nodeType===1&&(o.hasAttribute&&o.hasAttribute("data-custom-css")&&(n=!0),o.querySelectorAll&&o.querySelectorAll("[data-custom-css]").length>0&&(n=!0))})}),n&&processCustomCSS()});function elementEvents(t){let n=document.querySelector(t);n&&n.scrollIntoView({behavior:"smooth"})}function showElement(t){let n=document.querySelector(t);n&&(n.dataset.display&&n.dataset.display!=="none"?n.style.display=n.dataset.display:n.style.display="block")}function hideElement(t){let n=document.querySelector(t);n&&(n.dataset.display=n.style.display,n.style.display="none")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{customCssObserver.observe(document.body,{childList:!0,subtree:!0})}):customCssObserver.observe(document.body,{childList:!0,subtree:!0});const getCurrentDevice=function(){return window.matchMedia("(max-width: 575px)").matches?"mobilePortrait":window.matchMedia("(max-width: 992px)").matches?"tablet":"desktop"},shouldExecuteInteraction=function(t,n){if(t.action==="disabled")return!1;const i=r=>r==="mobile"?"mobilePortrait":r,o=i(t.device||"desktop"),a=i(n);return o==="desktop"?["desktop","tablet","mobilePortrait"].includes(a):o==="tablet"?["tablet","mobilePortrait"].includes(a):o==="mobilePortrait"&&a==="mobilePortrait"};let timeOnPage$1=0;setInterval(()=>{document.hasFocus()&&timeOnPage$1++},1e3);const triggerGoalAction=function(t,n){let i=n.closest("[data-sid]"),o={fid:window.fid,fnid:window.fnid,pgid:window.pgid,bid:window.bid,sid:i?i.getAttribute("data-sid"):void 0,cid:i?i.getAttribute("data-cid"):void 0,url:window.location.href,time:timeOnPage$1,goal_value:typeof t.data=="object"?decodeURIComponent(t.data.value):decodeURIComponent(t.data)};trackCustomEvent(t.action,o)},showModal=function(t,n){let i=document.querySelector(`#${t.data.modal_id}`);i&&(document.body.classList.add("modal-visible"),i.style.display="block")},hideModal=function(t,n){let i=document.querySelector(`#${t.data.modal_id}`);i&&(i.style.display="none",document.body.classList.remove("modal-visible"))};function getDeduplicationKey(t){return`${t.type||"unknown"}:${t.action||"unknown"}:${t.device||"desktop"}:${t.ccid||"unknown"}:${t.data?JSON.stringify(t.data):"none"}`}function trackSplitTestViews(){document.querySelectorAll("[data-sid]").forEach(t=>{t.getAttribute("data-split-test-view-tracked")||(elVisible(t)?(trackSplitTest(t),t.setAttribute("data-split-test-view-tracked",!0)):waitForVisible(t).then(()=>{trackSplitTest(t),t.setAttribute("data-split-test-view-tracked",!0)}))})}function trackSplitTest(t){trackCustomEvent("split-test-view",{fid:window.fid,fnid:window.fnid,pgid:window.pgid,bid:window.bid,sid:t.getAttribute("data-sid"),cid:t.getAttribute("data-cid"),url:window.location.href})}window.trackInteraction=function(interaction){const currentDevice=getCurrentDevice();if(interaction.device||(interaction.device="desktop"),console.log("Processing interaction:",{ccid:interaction.ccid,action:interaction.action,type:interaction.type,device:interaction.device,currentDevice,shouldExecute:shouldExecuteInteraction(interaction,currentDevice)}),!shouldExecuteInteraction(interaction,currentDevice))return void console.log("Skipping interaction due to device mismatch");let els=[];els=(interaction.type,document.querySelectorAll(`#${interaction.ccid}`)),console.log(`Found ${els.length} elements for ccid: ${interaction.ccid}`),els.length!==0?els.forEach(el=>{const targetValue=interaction.data?.value||"none";let sanitizedTarget=targetValue;sanitizedTarget=interaction.action==="execute-js"||targetValue.length>50?btoa(targetValue.substring(0,100)).replace(/[^a-zA-Z0-9]/g,"").substring(0,20):targetValue.replace(/[^a-zA-Z0-9\-_]/g,"");const interactionId=`${interaction.type}-${interaction.ccid}-${interaction.action}-${sanitizedTarget}`;if(console.log("Setting up interaction:",{interactionId,action:interaction.action,target:targetValue,alreadyExists:el.hasAttribute(`data-interaction-${interactionId}`)}),el.hasAttribute(`data-interaction-${interactionId}`))return void console.log("Skipping duplicate interaction:",interactionId);el.setAttribute(`data-interaction-${interactionId}`,"true");let callback=(interaction,el,e=null)=>{if(console.log("Executing interaction callback:",{action:interaction.action,ccid:interaction.ccid,type:interaction.type,triggerElement:el,targetValue:interaction.data?.value||"none",interactionData:interaction.data}),interaction.type==="click"&&e&&(["show_element","hide_element","visibility-toggle"].includes(interaction.action)&&e.stopPropagation(),el.tagName==="A"&&el.href&&el.href.startsWith("javascript:")&&e.preventDefault()),interaction.action.startsWith("animate-"))window.animationInteractions&&window.animationInteractions.executeAnimation?window.animationInteractions.executeAnimation(interaction,el):console.warn("Animation interaction attempted but animation system not loaded");else{if(interaction.action==="split-test-goal"&&triggerGoalAction(interaction,el),interaction.action==="show_modal"&&showModal(interaction),interaction.action==="hide_modal"&&hideModal(interaction),interaction.action==="track-event"){const t=interaction.data?.event_name||interaction.data;trackEvent(typeof t=="string"?{event_name:t}:t||{})}if(interaction.action==="purchase"&&trackPurchase(interaction.data),interaction.action==="custom-event"&&trackCustomEvent(interaction.data.name,interaction.data.value??null),interaction.action==="custom-meta-event"){const t=interaction.data&&interaction.data.value,n=t&&typeof t=="object"&&!Array.isArray(t)?{...t,ignore:["app"]}:{ignore:["app"]};trackCustomEvent(interaction.data.name,n)}if(interaction.action==="custom-ga-event"){const t=interaction.data&&interaction.data.value,n=t&&typeof t=="object"&&!Array.isArray(t)?{...t,ignore:["app"]}:{ignore:["app"]};trackCustomEvent(interaction.data.name,n)}if(interaction.action==="focus-on-element"&&elementEvents(interaction.data.value),interaction.action==="execute-js")try{eval(interaction.data.value)}catch(t){console.error("Error executing JS:",t)}if(interaction.action==="show_element"){const t=document.querySelector(interaction.data.value);console.log(`Showing element: ${interaction.data.value}`,{targetExists:!!t,targetElement:t});try{showElement(interaction.data.value),console.log(`showElement completed for: ${interaction.data.value}`)}catch(n){console.error(`showElement failed for: ${interaction.data.value}`,n)}}if(interaction.action==="hide_element"){const t=document.querySelector(interaction.data.value);console.log(`Hiding element: ${interaction.data.value}`,{targetExists:!!t,targetElement:t}),hideElement(interaction.data.value)}if(interaction.action==="visibility-toggle"){const t=document.querySelector(interaction.data.value);if(t){const n=window.getComputedStyle(t).display,i=n==="none"?"block":"none";console.log(`Toggling visibility for: ${interaction.data.value}`,{currentDisplay:n,newDisplay:i,targetElement:t}),t.style.display=i}else console.warn(`Target element not found for visibility-toggle: ${interaction.data.value}`)}interaction.action!=="disabled"||console.log(`Interaction disabled for ${getCurrentDevice()}: ${interaction.ccid}`)}};interaction.type==="load"?window.addEventListener("load",()=>{callback(interaction,el)},{once:!0}):interaction.type==="hover"?addCustomEventListener(el,"mouseenter",t=>{callback(interaction,el,t)}):interaction.type==="blur"?(el.tabIndex===-1&&(el.tabIndex=0),addCustomEventListener(el,"blur",t=>{callback(interaction,el,t)}),addCustomEventListener(el,"mouseleave",t=>{callback(interaction,el,t)})):interaction.type==="on-form-submit"?el.tagName==="FORM"&&addCustomEventListener(el,"submit",t=>{callback(interaction,el,t)}):interaction.type==="on-form-success"?document.addEventListener("on-form-success",t=>{t.detail&&t.detail.form===el&&callback(interaction,el,t)}):interaction.type==="on-form-error"?document.addEventListener("on-form-error",t=>{t.detail&&t.detail.form===el&&callback(interaction,el,t)}):(interaction.type,console.log(`Adding ${interaction.type} listener for ${interaction.ccid} -> ${interaction.action} (${interaction.data?.value})`),addCustomEventListener(el,interaction.type,t=>{console.log(`Event fired for ${interaction.ccid}: ${interaction.action} -> ${interaction.data?.value}`),callback(interaction,el,t)}),interaction.type==="click"&&addCustomEventListener(el,"touchstart",t=>{console.log(`Touch event fired for ${interaction.ccid}: ${interaction.action} -> ${interaction.data?.value}`),callback(interaction,el,t)}))}):console.warn(`No elements found for interaction: ${interaction.ccid}`)},document.addEventListener("DOMContentLoaded",function(){const t=getCurrentDevice();console.log("Current device detected:",t),console.log("Total interactions found:",window.int?window.int.length:0);const n=new Set,i=[];window.int.forEach(r=>{r.device||(r.device="desktop");const d=getDeduplicationKey(r);n.has(d)?console.log("Skipping duplicate event:",{ccid:r.ccid,type:r.type,action:r.action,dedupKey:d}):(n.add(d),i.push(r))}),console.log(`Deduplicated ${window.int.length} interactions to ${i.length} unique events`);const o=new Set;let a;i.forEach(r=>{if((r.device==="mobile"?"mobilePortrait":r.device)===t&&r.action==="disabled"){const d=`${r.ccid}-${r.type}`;o.add(d),console.log(`Disabled trigger found: ${d}`)}}),i.forEach(r=>{const d=`${r.ccid}-${r.type}`;o.has(d)?console.log(`Skipping disabled trigger: ${d}`):r.action!=="disabled"&&shouldExecuteInteraction(r,t)&&(console.log("Processing cascaded interaction:",{ccid:r.ccid,type:r.type,action:r.action,device:r.device,currentDevice:t}),trackInteraction(r))}),window.addEventListener("resize",()=>{clearTimeout(a),a=setTimeout(()=>{const r=getCurrentDevice();r!==t&&(console.log("Device changed from",t,"to",r),t=r,function(){console.log("Reinitializing interactions for device:",t),window.int&&window.int.forEach(d=>{shouldExecuteInteraction(d,t)&&document.querySelectorAll(`#${d.ccid}`).forEach(c=>{const l=d.data?.value||"none";let u=l;u=d.action==="execute-js"||l.length>50?btoa(l.substring(0,100)).replace(/[^a-zA-Z0-9]/g,"").substring(0,20):l.replace(/[^a-zA-Z0-9\-_]/g,"");const s=`${d.type}-${d.ccid}-${d.action}-${u}`;c.hasAttribute(`data-interaction-${s}`)||(console.log("Adding interaction for new device:",s),trackInteraction(d))})}),console.log("Interactions reinitialized for device:",t)}(),window.mobileExitIntentDeviceChange&&window.mobileExitIntentDeviceChange(r))},250)})}),window.overrideDesktopTrigger=function(t,n=null){if(!window.int)return void console.warn("No interactions array found");let i=getCurrentDevice();i==="mobile"&&(i="mobilePortrait");const o=n||t.ccid,a={...JSON.parse(JSON.stringify(t)),device:i,ccid:o,data:t.data?JSON.parse(JSON.stringify(t.data)):{data:1}};return window.int.push(a),trackInteraction(a),console.log(`Override trigger created for ${o} on ${i}:`,a),a},window.disableDesktopTrigger=function(t,n=null){if(!window.int)return void console.warn("No interactions array found");let i=getCurrentDevice();i==="mobile"&&(i="mobilePortrait");const o=n||t.ccid,a={type:t.type,action:"disabled",device:i,ccid:o,is_component:t.is_component||!1,data:{disabled:!0}};return window.int.push(a),console.log(`Disable trigger created for ${o} on ${i}:`,a),a},window.getCascadedTriggers=function(t){if(!window.int||!t)return[];const n=getCurrentDevice();let i=n;if(i==="mobile"&&(i="mobilePortrait"),i==="desktop")return[];const o=window.int.filter(c=>c.ccid===t),a=[],r=new Set,d=new Set;return o.forEach(c=>{let l=c.device||"desktop";l==="mobile"&&(l="mobilePortrait"),l===i&&(c.action==="disabled"?d.add(c.type):r.add(c.type))}),o.forEach(c=>{let l=c.device||"desktop";l==="mobile"&&(l="mobilePortrait"),!(l===i||c.action==="disabled")&&shouldExecuteInteraction(c,n)&&(r.has(c.type)||d.has(c.type)||a.push(c))}),a},window.isTriggerDisabled=function(t,n){if(!window.int)return!1;let i=getCurrentDevice();return i==="mobile"&&(i="mobilePortrait"),window.int.some(o=>{let a=o.device||"desktop";return a==="mobile"&&(a="mobilePortrait"),o.ccid===t&&o.type===n&&o.action==="disabled"&&a===i})},window.removeInteraction=function(t){if(!window.int)return!1;const n=window.int.length;window.int=window.int.filter(o=>!(o.ccid===t.ccid&&o.type===t.type&&o.action===t.action&&o.device===t.device)),window.getCurrentDevice=getCurrentDevice;const i=window.int.length!==n;return i&&console.log("Removed interaction:",t),i},window.getCurrentDevice=getCurrentDevice,window.shouldExecuteInteraction=shouldExecuteInteraction,document.addEventListener("DOMContentLoaded",function(){setTimeout(()=>{trackSplitTestViews()},100)});class SeedInstructionsAlert{constructor(){this.instructions=window.seed_instructions||[],this.alertShown=!1,this.init()}init(){this.instructions.length>0&&!this.alertShown&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.showAlert()):this.showAlert())}showAlert(){const n=`
            <div style="
                position: fixed;
                top: 20px;
                right: 20px;
                max-width: 400px;
                background: #f8f9fa;
                border: 2px solid #007bff;
                border-radius: 8px;
                padding: 20px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10000;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                font-size: 14px;
                line-height: 1.5;
            ">
                <div style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 15px;
                ">
                    <h4 style="
                        margin: 0;
                        color: #007bff;
                        font-size: 16px;
                        font-weight: 600;
                    ">ðŸ“‹ Funnel Instructions</h4>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: none;
                        border: none;
                        font-size: 18px;
                        cursor: pointer;
                        color: #6c757d;
                        padding: 0;
                        width: 24px;
                        height: 24px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    ">&times;</button>
                </div>
                <div style="color: #495057;">
                    <p style="margin: 0 0 10px 0; font-weight: 500;">Next steps to follow:</p>
                    <ul style="margin: 0; padding-left: 20px;">
                        ${this.instructions.map(o=>`<li style="margin-bottom: 8px;">${this.escapeHtml(o)}</li>`).join("")}
                    </ul>
                </div>
            </div>
        `,i=document.createElement("div");i.innerHTML=n,document.body.appendChild(i),this.alertShown=!0,setTimeout(()=>{i.parentNode&&i.remove()},3e4),console.log("Seed Instructions Alert displayed:",this.instructions)}escapeHtml(n){const i=document.createElement("div");return i.textContent=n,i.innerHTML}}typeof window<"u"&&(window.seedInstructionsAlert=new SeedInstructionsAlert),document.querySelector("*[data-youtube-code], *[data-direct-link]"),window.onload=function(){document.querySelectorAll('*[data-page-modal="open"]').forEach(function(t){let n=t.getAttribute("data-page-id"),i="/"+n,o=document.createElement("div");o.setAttribute("id",`modal_${n}`),o.style.position="fixed",o.style.zIndex="9999",o.style.width="100%",o.style.height="100%",o.style.overflow="none",o.style.top=0,o.style.display="none";let a=document.createElement("iframe");a.setAttribute("src",i),a.style.width="100%",a.style.height="100%",a.style.border="none",o.appendChild(a),document.body.appendChild(o),t.addEventListener("click",function(r){r.preventDefault(),document.body.classList.add("modal-visible");let d=document.getElementById(`modal_${n}`);d.style.display="block",d.querySelector("iframe").classList.add("slide-down"),player&&player.pause()}),o.addEventListener("click",function(r){r.target===o&&(o.style.display="none",document.body.classList.remove("modal-visible"))}),document.addEventListener("keydown",function(r){if(r.key==="Escape"){let d=document.getElementById(`modal_${n}`);d&&d.style.display==="block"&&(d.style.display="none",document.body.classList.remove("modal-visible"))}})})},(()=>{let t=document.querySelector("title");if(!t)return;let n=t.textContent,i=t.getAttribute("data-blur");if(i===null||i.length===0)return;let o=!1;window.addEventListener("blur",()=>{o||(o=!0,t.textContent=i,setTimeout(function a(){o&&(t.textContent=t.textContent===i?"(1) "+n:i,setTimeout(a,1500))},1500))}),window.addEventListener("focus",()=>{o&&(o=!1,t.textContent=n)})})();let forms=document.querySelectorAll("form");function post(t,n){return fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(n))})}async function getRecaptchaToken(t){return new Promise((n,i)=>{grecaptcha.ready(()=>{grecaptcha.execute(t,{action:"submit"}).then(n).catch(i)})})}async function handleForm(t){document.dispatchEvent(new CustomEvent("on-form-submit",{detail:{form:t,form_id:t.getAttribute("id")}}));let n=t.querySelector("[data-form-error-message]"),i=t.querySelector("[data-form-success-message]");n&&(n.style.display="none"),i&&(i.style.display="none");let o=null,a=null,r=t.querySelector('button[type="submit"]'),d=null;r?d=r.innerHTML:(o=t.querySelector('input[type="submit"]'),o?a=o.value:(r=t.querySelector("button"),r&&(d=r.innerHTML))),o?(o.value="Loading...",o.disabled=!0):r&&(r.innerHTML="Loading...",r.disabled=!0);let c=new FormData(t);c.append("_csrf",window.csrf_token),c.append("_form_url",window.location.href);let l=null,u=t.querySelector('[data-recaptcha-v3="true"]');if(u){const s=await getRecaptchaToken(u.getAttribute("data-site-key"));c.append("g-recaptcha-response",s)}try{l=await post(t.getAttribute("action"),c);let s=await l.json();if(l.status==200){document.dispatchEvent(new CustomEvent("on-form-success",{detail:{form:t,form_id:t.getAttribute("id"),response:s}}));let p=t.getAttribute("data-redirect-url"),g=t.getAttribute("data-success-message"),w=t.getAttribute("data-open-modal");if(p)return document.dispatchEvent(new CustomEvent("form-submitted",{detail:{form:t}})),void(window.location.href=decodeURIComponent(p));if(w){let m=document.querySelector(`#${w}`);m&&(m.style.display="block"),t.reset()}else i&&g&&(i.textContent=decodeURIComponent(g),i.style.display="block"),t.reset()}l.status==400&&n&&(document.dispatchEvent(new CustomEvent("on-form-error",{detail:{form:t,form_id:t.getAttribute("id"),response:s}})),n.innerHTML=s.error||s.errors.join("<br />"),n.style.display="block")}catch(s){console.log(s),n.innerHTML="There was an error submitting the form. Please try again later.",n.style.display="block"}o?(o.value=a,o.disabled=!1):r&&d!==null&&(r.innerHTML=d,r.disabled=!1)}function trackPageSwitchedTab(t){let n=window.fid,i=window.fnid,o=window.pgid,a=window.bid,r=window.location.href;r=r.replace(window.location.origin,"");let d={fid:n,fnid:i,pgid:o,bid:a,url:r,time:timeOnPage,switched_back:t};d=addUtmParams(d);for(let c in TrackingListeners)TrackingListeners[c].tabSwitched(d)}forms.forEach(t=>{let n=t.getAttribute("action");if(n&&n.indexOf("/api")===0){let i=document.createElement("input");i.type="hidden",i.name="_csrf",i.value=window.csrf_token,t.appendChild(i);let o=t.querySelector('[data-recaptcha-v3="true"]');if(o){const a=o.getAttribute("data-site-key");if(a){const r=document.createElement("script");r.src=`https://www.google.com/recaptcha/api.js?render=${a}`,document.head.appendChild(r)}else console.error("Site key is missing.")}t.addEventListener("submit",a=>{a.preventDefault(),handleForm(t)})}});const trackTabChanges=()=>{let t="hidden",n=document[t];document.addEventListener("visibilitychange",()=>{n===document[t]||window.page_exit_tracked||(document[t]?trackPageSwitchedTab(!1):trackPageSwitchedTab(!0),n=document[t])})};function trackElementsHover(){document.querySelectorAll(["h1","h2","h3","button","a","p","span","li","b",'input[type="submit"]'].join(",")).forEach(t=>{addCustomEventListener(t,"mouseover",n=>{new Date().getTime(),t.setAttribute("data-hovered",!0),setTimeout(()=>{if(t.hasAttribute("data-hovered")&&!t.hasAttribute("data-hovered-sent")){t.setAttribute("data-hovered-sent",!0);let i=window.fid,o=window.fnid,a=window.pgid,r=window.bid,d=window.location.href;d=d.replace(window.location.origin,"");let c=t.innerText;c=c.substring(0,50)+(c.length>50?"...":"");let l={fid:i,fnid:o,pgid:a,bid:r,url:d,time:timeOnPage,tag:t.tagName.toLowerCase(),text:c};l=addUtmParams(l);for(let u in TrackingListeners)TrackingListeners[u].elementHover(l)}},200)}),addCustomEventListener(t,"mouseout",n=>{t.removeAttribute("data-hovered")})})}function trackFormStart(){document.querySelectorAll(['input[type="text"]','input[type="number"]','input[type="email"]',"textarea"].join(",")).forEach(t=>{addCustomEventListener(t,t.tagName.toLowerCase()==="select"?"change":"keyup",n=>{let i=t.closest("form");if(i&&!i.hasAttribute("data-form-started")){i.setAttribute("data-form-started",!0);let o={tag:t.tagName.toLowerCase()};o=addUtmParams(o);for(let a in TrackingListeners)TrackingListeners[a].formStart(o)}})})}const firedAutomations=new Set;function initAutomationTriggers(t){if(!t||!Array.isArray(t))return;const n=findAutomationEvents(t);n.length!==0&&(console.log("[AutomationTriggers] Found",n.length,"automation trigger(s)"),n.forEach(i=>{i.data&&i.data.token&&setupPageExitTrigger(i.data.token)}))}function findAutomationEvents(t){const n=[];return function i(o){if(Array.isArray(o))for(const a of o)a.type==="execute_automation"&&n.push(a),a.next&&Array.isArray(a.next)&&i(a.next)}(t),n}function setupPageExitTrigger(t){const n=`page_exit_${t.substring(0,30)}`;console.log("[AutomationTriggers] Setting up page exit trigger"),window.addEventListener("beforeunload",()=>{fireAutomation(t,n,{trigger:"page_exit",time_on_page:window.timeOnPage||0})}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&fireAutomation(t,n,{trigger:"visibility_hidden",time_on_page:window.timeOnPage||0})}),window.addEventListener("pagehide",()=>{fireAutomation(t,n,{trigger:"pagehide",time_on_page:window.timeOnPage||0})})}function fireAutomation(t,n,i={}){if(firedAutomations.has(n))return;firedAutomations.add(n);const o={token:t,context:{...i,page_url:window.location.href,pgid:window.pgid,fid:window.fid,fnid:window.fnid,bid:window.bid}},a="/api/trigger-automation";if(console.log("[AutomationTriggers] Firing automation:",n),navigator.sendBeacon)try{const r=new Blob([JSON.stringify(o)],{type:"application/json"});if(navigator.sendBeacon(a,r))return void console.log("[AutomationTriggers] Beacon sent successfully")}catch(r){console.warn("[AutomationTriggers] Beacon failed, falling back to fetch:",r)}try{fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),keepalive:!0}).catch(r=>{console.error("[AutomationTriggers] Fetch failed:",r)})}catch(r){console.error("[AutomationTriggers] Failed to send automation trigger:",r)}}function getUrlParams(){let t={};return window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(n,i,o){t[i]=o}),t}function addUtmParams(t){const n=getUrlParams();return n.utm_source&&(t.utm_source=n.utm_source),n.utm_medium&&(t.utm_medium=n.utm_medium),n.utm_campaign&&(t.utm_campaign=n.utm_campaign),n.utm_term&&(t.utm_term=n.utm_term),n.utm_content&&(t.utm_content=n.utm_content),t}function extractAIContextFromComponent(t){const n={contentType:t.dataset.aiContentType||null,psychologyIntent:t.dataset.aiPsychology||null,customTags:{}};return Object.keys(t.dataset).forEach(i=>{if(i.startsWith("ai")&&!["aiContentType","aiPsychology"].includes(i)){const o=i.replace(/^ai/,"").toLowerCase();n.customTags[o]=t.dataset[i]}}),n}function calculatePsychologySignals(t,n,i){const o={},a=i.toLowerCase();return t.contentType!=="faq"&&t.psychologyIntent!=="reduce-skepticism"||(o.skepticism_signal="high",o.trust_seeking=!0,o.resolution_intent="active",a.includes("side effect")||a.includes("safe")||a.includes("harm")?o.objection_category="safety":a.includes("work")||a.includes("effective")||a.includes("result")?o.objection_category="efficacy":a.includes("price")||a.includes("cost")||a.includes("expensive")?o.objection_category="price":(a.includes("shipping")||a.includes("delivery")||a.includes("arrive"))&&(o.objection_category="shipping")),t.contentType!=="testimonial"&&t.psychologyIntent!=="build-trust"||(o.trust_seeking=!0,o.social_validation_seeking=!0),(t.contentType==="science"||a.includes("study")||a.includes("research")||a.includes("proven"))&&(o.credibility_seeking=!0,o.authority_validation=!0),(t.contentType==="pricing"||a.includes("price")||a.includes("$")||a.includes("buy"))&&(o.price_sensitivity="high",o.value_assessment=!0),(t.contentType==="guarantee"||a.includes("guarantee")||a.includes("refund")||a.includes("money back"))&&(o.risk_aversion="high",o.safety_seeking=!0),o}document.addEventListener("DOMContentLoaded",()=>{window.page_events&&initAutomationTriggers(window.page_events)}),document.readyState!=="complete"&&document.readyState!=="interactive"||setTimeout(()=>{window.page_events&&!window._automationTriggersInitialized&&(window._automationTriggersInitialized=!0,initAutomationTriggers(window.page_events))},100),window.timeOnPage=0,setInterval(()=>{document.hasFocus()&&window.timeOnPage++},1e3);const trackPageExitEvent=function(){let t=window.fid,n=window.fnid,i=window.pgid,o=window.bid,a=window.location.href;a=a.replace(window.location.origin,"");let r={fid:t,fnid:n,pgid:i,bid:o,url:a,time:timeOnPage};window.page_exit_tracked=!0,r=addUtmParams(r),sendPageExitEvent(r)},trackPageView=function(){let t=window.fid,n=window.fnid,i=window.pgid,o=window.bid,a=window.location.href;a=a.replace(window.location.origin,"");let r={fid:t,fnid:n,pgid:i,bid:o,url:a,time:timeOnPage,referrer:document.referrer||void 0,referrer_domain:document.referrer?new URL(document.referrer).hostname:void 0};r=addUtmParams(r),sendPageViewEvent(r)},trackPageScroll=function(){let t=window.fid,n=window.fnid,i=window.pgid,o=window.bid,a=window.location.href;a=a.replace(window.location.origin,"");let r={fid:t,fnid:n,pgid:i,bid:o,url:a,time:timeOnPage,scroll_y:window.scrollY};r=addUtmParams(r),sendPageScrollEvent(r)},trackComponentClickEvent=function(t,n){if(t.tagName==="A"&&(t.getAttribute("href")==="#"||t.getAttribute("href")==="javascript:;"||t.getAttribute("href")?.startsWith("/b")))return;let i=n.getAttribute("data-cid"),o=n.getAttribute("data-sid"),a=window.fid,r=n.getAttribute("data-fnid"),d=window.pgid,c=window.bid,l=t.href??"";l=l.replace(window.location.origin,"");let u=window.location.href;u=u.replace(window.location.origin,"");let s="unknown",p="";t.tagName==="A"?(s="link",p=t.innerText||t.textContent||""):t.tagName==="BUTTON"?(s="button",p=t.innerText||t.textContent||""):t.hasAttribute("data-accordion-title")||t.classList.contains("accordion-title")?(s="accordion",p=t.innerText||t.textContent||""):t.hasAttribute("role")?(s=t.getAttribute("role"),p=t.innerText||t.textContent||t.getAttribute("aria-label")||""):t.hasAttribute("data-toggle")?(s="toggle",p=t.innerText||t.textContent||""):(s="interactive",p=t.innerText||t.textContent||"");let g={cid:i,sid:o,fid:a,fnid:r,pgid:d,bid:c,text:p.trim(),href:l,url:u,time:timeOnPage,element_type:s};const w=extractAIContextFromComponent(n);if(w.contentType){g.content_type=w.contentType,g.psychology_intent=w.psychologyIntent,g.custom_tags=w.customTags;const _=calculatePsychologySignals(w,t,p);Object.assign(g,_)}let m=!1;if(t.tagName==="A"&&t.href)try{new URL(t.href).hostname!==window.location.hostname&&(m=!0)}catch(_){console.log("Error parsing link",_)}g.funnel_click=m,g.href_code=t.getAttribute("data-href-code")??null,g=addUtmParams(g),sendClickEvent(g)},trackClickEvent=function(t){if(t.hasAttribute("data-quiz-button")||t.hasAttribute("data-quiz-option")||t.closest("[data-quiz-button]")||t.closest("[data-quiz-option]")||t.tagName==="A"&&(t.getAttribute("href")==="#"||t.getAttribute("href")==="javascript:;"||!t.getAttribute("href")&&!t.hasAttribute("role")&&!t.hasAttribute("data-toggle")))return;let n=window.fid,i=window.pgid,o=window.bid,a=t.href??"";a=a.replace(window.location.origin,"");let r=window.location.href;r=r.replace(window.location.origin,"");let d="unknown",c="";t.tagName==="A"?(d="link",c=t.innerText||t.textContent||""):t.tagName==="BUTTON"?(d="button",c=t.innerText||t.textContent||""):t.hasAttribute("data-accordion-title")||t.classList.contains("accordion-title")?(d="accordion",c=t.innerText||t.textContent||""):t.hasAttribute("role")?(d=t.getAttribute("role"),c=t.innerText||t.textContent||t.getAttribute("aria-label")||""):t.hasAttribute("data-toggle")?(d="toggle",c=t.innerText||t.textContent||""):(d="interactive",c=t.innerText||t.textContent||"");let l={fid:n,pgid:i,bid:o,text:c.trim(),href:a,url:r,time:timeOnPage,element_type:d};l=addUtmParams(l);let u=!1;if(t.tagName==="A"&&t.href)try{new URL(t.href).hostname!==window.location.hostname&&(u=!0)}catch(s){console.log("Error parsing link",s)}l.funnel_click=u,l.href_code=t.getAttribute("data-href-code")??null,sendClickEvent(l)},trackAllClicks=()=>{addCustomEventListener(document,"click",t=>{let n=t.target,i=n.closest('a, button, [role="button"], [role="tab"], [tabindex], .clickable, [data-toggle], [data-accordion-title]');if(!i){let a=n.closest("[onclick], [data-click], .interactive, .toggle, .tab, .accordion-title");a&&(i=a)}if(!i)return;let o=t.target.closest("[data-cid]");o?trackComponentClickEvent(i,o):(i.tagName==="BUTTON"||i.tagName==="A"&&i.getAttribute("href")||i.hasAttribute("role")||i.hasAttribute("data-toggle")||i.classList.contains("clickable")||i.classList.contains("interactive"))&&trackClickEvent(i)})};document.addEventListener("DOMContentLoaded",function(){trackAllClicks(),watchBuyButtons(),trackTabChanges(),trackElementsHover(),trackFormStart(),window.page_events&&initAutomationTriggers(window.page_events),(window.t||[]).forEach(t=>{Array.isArray(t)&&typeof t[0]=="string"&&startTracking(t[0],t[1])});try{const t=(n,i)=>{i&&!TrackingListeners[n]&&startTracking(n)};t("ga",typeof window.gtag=="function"),t("meta",typeof window.fbq=="function"),t("tiktok",window.ttq!==void 0),t("linkedin",typeof window.lintrk=="function"),t("snapchat",typeof window.snaptr=="function"),t("pinterest",typeof window.pintrk=="function"),t("twitter",typeof window.twq=="function"),t("hotjar",typeof window.hj=="function"),t("clarity",typeof window.clarity=="function")}catch{}trackPageView(),window.addEventListener("beforeunload",trackPageExitEvent)});let scrollTimer=null;function trigger_split_test_result(t,n={}){console.log("Trigger trigger_split_test_result",t),t.type==="exit_popup"&&(n.exitpopup_id=parseInt(t.data.value));const i=t.data.split_test_id||t.data.sid;let o={fid:window.fid,pgid:window.pgid,bid:window.bid,fnid:t.step_id,url:window.location.href,sid:i,...n};i&&(window.sids=window.sids||[],window.sids.push(i)),trackCustomEvent("split-test-view",o)}function determine_split_result_frontend(t,n){return typeof window<"u"&&new URLSearchParams(window.location.search).has("debug112")&&console.log("[SplitTest Frontend] Using random selection"),weightedRandomSelection(n)}async function determine_split_result_backend(t,n,i){try{const{default:o}=await __vitePreload(async()=>{const{default:a}=await import("./DeterministicSplitTestManager-CdCzGSBv.js");return{default:a}},[]);if(i&&i.req&&i.req.query&&i.req.query.debug112==="1"&&console.log("[SplitTest Backend] deterministic manager loaded"),o){const a=await o.getNextStep(t.data.split_test_id,n);if(a){const r=a.step;return i&&i.req&&i.req.query&&i.req.query.debug112==="1"&&console.log("[SplitTest Backend] deterministic outcome",{split_test_id:t.data.split_test_id,node_code:r?.node_code}),i.req&&(i.res.cookie(`st_res_${t.data.split_test_id}`,r.node_code,{maxAge:6048e5,httpOnly:!0}),i.req.cookies[`st_res_${t.data.split_test_id}`]=r.node_code),r}}}catch(o){i&&i.req&&i.req.query&&i.req.query.debug112==="1"&&console.warn("Deterministic split test manager not available, falling back to random:",o.message)}return null}function weightedRandomSelection(t){return function(n,i){const o=new Date;var a;const r=function(c,l){for(const u of l)if(c>=u.startMinute&&c<=u.endMinute)return u.adjustments;return null}(60*(a=o).getHours()+a.getMinutes(),i);let d=n;return r&&typeof r=="object"&&(d=n.map(c=>({...c,weight:r[c.step_id]!==void 0?parseFloat(r[c.step_id]):c.weight}))),function(c){const l=c.filter(w=>typeof w.weight=="number"&&w.weight>0),u=l.length>0?l:c,s=u.reduce((w,m)=>w+Math.max(0,typeof m.weight=="number"?m.weight:0),0);if(s<=0)return u[0].step;let p=Math.random()*s,g=0;for(const w of u)if(g+=Math.max(0,typeof w.weight=="number"?w.weight:0),p<=g)return w.step;return u[u.length-1].step}(d)}(t,[])}async function determine_split_result(t,n){const i=[];let o=null;if(typeof window<"u"&&new URLSearchParams(window.location.search).has("debug112")&&console.log("[SplitTest] determine_split_result start",{split_test_id:t?.data?.split_test_id,winner_node_code:t?.data?.winner_node_code}),n.req?n.req.cookies[`st_res_${t.data.split_test_id}`]&&(o=n.req.cookies[`st_res_${t.data.split_test_id}`]):check_cookie(`st_res_${t.data.split_test_id}`)&&(o=get_cookie(`st_res_${t.data.split_test_id}`)),t.data.winner_node_code){let r=find_next_by_step_id(t,t.data.winner_node_code);if(r)return typeof window<"u"&&new URLSearchParams(window.location.search).has("debug112")&&console.log("[SplitTest] winner_node_code active, short-circuit to winner",{winner_node_code:t.data.winner_node_code}),r.next[0]}if(t.next.forEach(function(r){i.push({step_id:r.next[0].step_id,step:r.next[0],weight:parseFloat(r.data.value)})}),o){let r=find_next_by_step_id(t,o);if(r)return typeof window<"u"&&new URLSearchParams(window.location.search).has("debug112")&&console.log("[SplitTest] existing session result found, reusing",{split_test_id:t.data.split_test_id,node_code:o}),r}try{const r=i.map(d=>({node_code:d.step?.node_code,weight:d.weight}));typeof window<"u"&&new URLSearchParams(window.location.search).has("debug112")&&console.log("[SplitTest] candidates prepared",{split_test_id:t.data.split_test_id,candidates:r})}catch{}let a;return n&&n.req&&(a=await determine_split_result_backend(t,i,n),a)||(a=determine_split_result_frontend(t,i),typeof window<"u"&&new URLSearchParams(window.location.search).has("debug112")&&console.log("[SplitTest] random outcome",{split_test_id:t.data.split_test_id,node_code:a?.node_code}),n.req?(n.res.cookie(`st_res_${t.data.split_test_id}`,a.node_code,{maxAge:6048e5,httpOnly:!0}),n.req.cookies[`st_res_${t.data.split_test_id}`]=a.node_code):set_cookie(`st_res_${t.data.split_test_id}`,a.node_code,null,!0)),a}async function wait(t){return new Promise((n,i)=>{setTimeout(()=>{n()},1e3*t)})}async function asyncForEach(t,n,i=!1){for(let o=0;o<t.length;o++){if(i)return;await n(t[o],o,t,i)}}function get_next_step(t,n){return t.next&&t.next.length>n?t.next[n]:null}function find_next_by_step_id(t,n){if(t.step_id==n||t.node_code==n)return t;if(t.next&&t.next.length>0)for(let i=0;i<t.next.length;i++){let o=find_next_by_step_id(t.next[i],n);if(o)return o}return null}function find_node_in_flow(t,n){if(!t||t.length===0)return null;if(t.flow&&Array.isArray(t.flow))return find_node_in_flow(t.flow,n);for(let i of t){if(i.id===n)return i;if(i.next&&i.next.length>0){let o=find_node_in_flow(i.next,n);if(o)return o}}return null}async function processBaseFunnelNode(t,n={},i=[]){if(!t)return;sendFunnelNodeEvent({...t,...n});let o=t;if(!t.type||t===null)return t;let a=!1;for(;t&&!a;){if(!t.type){t=null;break}switch(t.type){case"recursive":let r=null;if(typeof window<"u")r=window.page_events;else if(n.funnelService&&n.funnelService.funnel&&n.funnelService.funnel.flow){if(r=n.funnelService.funnel.flow,typeof r=="string")try{r=JSON.parse(r)}catch(c){console.error("Failed to parse flow data JSON:",c),r=null}}else if(n.flow&&(r=n.flow,typeof r=="string"))try{r=JSON.parse(r)}catch(c){console.error("Failed to parse opts.flow data JSON:",c),r=null}if(t.recursive_id&&t.recursive_id!==t.id){let c=null;const l=[];n.page_events_flow&&(n.page_events_flow.backend&&Array.isArray(n.page_events_flow.backend)&&l.push({name:"page_events_backend",flow:n.page_events_flow.backend}),n.page_events_flow.frontend&&Array.isArray(n.page_events_flow.frontend)&&l.push({name:"page_events_frontend",flow:n.page_events_flow.frontend})),r&&l.push({name:"main_flow",flow:r});for(const u of l)if(c=find_node_in_flow(u.flow,t.recursive_id),c){n.req?.query?.debug112&&console.log(`âœ… Found recursive node (id: ${t.recursive_id}) in ${u.name} flow - type: ${c.type}`);break}if(!c&&n.req?.query?.debug112&&console.warn(`âš ï¸ Recursive node (id: ${t.recursive_id}) not found in any flow source (searched ${l.length} sources)`),c&&c.id!==t.id&&c.type!=="recursive")typeof window<"u"&&["script_rule","dynamic_container","page_variant","product_check","cloaking_house","execute_automation"].includes(c.type)?(t=null,a=!0):t=c;else{let u=get_next_step(t,0);u?t=u:(t=null,a=!0)}}else{let c=get_next_step(t,0);c?t=c:(t=null,a=!0)}break;case"wait":a=!0,wait(t.data.value).then(c=>{n.callback&&n.callback(c),processBaseFunnelNode(t=get_next_step(t,0),n)});break;case"entry":t=get_next_step(t,0);break;default:let d=null;if(t&&t.type&&await asyncForEach(i,async c=>{if(t)return c.type===t.type?(n.req?.query?.debug112&&console.log("[BaseFunnelFlow] Processing extended handler for:",t.type,t.node_code),d=await c.process(t,n,i),n.req?.query?.debug112&&console.log("[BaseFunnelFlow] Handler returned:",d?.type,d?.node_code),d&&(t=d),t):void 0}),o!=t&&sendFunnelNodeEvent({...t,...n}),d==null||d&&!d.type){n.req?.query?.debug112&&console.log("[BaseFunnelFlow] Handler returned null or node with null type, stopping processing"),t=null;break}}}o!=t&&sendFunnelNodeEvent({...t,...n})}async function show_exit_popup(t){if(parseInt(t)!=t)return;let n=document.querySelectorAll('[data-modal="true"]'),i=!1;if(n.forEach(l=>{l.style.display==="block"&&(i=!0)}),i)return;let o=document.getElementById("exit_popup_"+t),a=function(l,u=0){let s=document.getElementById("exit_"+l);s?(s.style.display="block",document.body.classList.add("modal-visible"),s.querySelector("*[data-modal]")&&(s.querySelector("*[data-modal]").style.display="block"),s.querySelectorAll('[data-modal-close="true"], [data-action="close-exitpopup"]').forEach(p=>{p.addEventListener("click",g=>{s.style.display="none",s.querySelector("*[data-modal]").style.display="none",document.body.classList.remove("modal-visible")})}),s.querySelectorAll("form").forEach(p=>{let g=p.getAttribute("action");g&&g.indexOf("/api")===0&&p.addEventListener("submit",w=>{w.preventDefault(),handleForm(p)})})):u<5?setTimeout(()=>{a(l,u++)},50):console.error("Exit popup not found: "+l)};if(o){let l=document.getElementById("exit_"+t);return l.style.display="block",document.body.classList.add("modal-visible"),console.log("exit.querySelector('*[data-modal]')",l.querySelector("*[data-modal]")),l.querySelector("*[data-modal]")&&(l.querySelector("*[data-modal]").style.display="block"),void a(t)}o=document.createElement("script");const r=window.pgid?`&pg=${window.pgid}`:"",d=window.fid?`&fid=${window.fid}`:"",c=window.fnid?`&fnid=${window.fnid}`:"";o.src=`/ex/${t}?b=${bid}${r}${d}${c}`,o.async=!0,o.id="exit_popup_"+t,o.onload=()=>{setTimeout(()=>{a(t)},10)},document.body.appendChild(o)}window.addEventListener("scroll",function(){scrollTimer&&clearTimeout(scrollTimer),scrollTimer=setTimeout(function(){trackPageScroll()},300)});const isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),MOBILE_EXIT_CONFIG={fastScrollThreshold:.8,velocityTimeWindow:100,minScrollDistance:50,debounceTime:2e3,directionChangeThreshold:3};let scrollState={lastScrollY:0,lastScrollTime:0,scrollVelocity:0,fastScrollCount:0,directionChanges:0,lastDirection:null,isTriggered:!1,lastTriggerTime:0},mobileExitIntentInitialized=!1;function addExitScriptTags$1(t){if(t.type=="exit_popup"){let n=document.createElement("script");const i=window.pgid?`&pg=${window.pgid}`:"",o=window.fid?`&fid=${window.fid}`:"",a=window.fnid?`&fnid=${window.fnid}`:"";n.src=`/ex/${t.data.value}?b=${bid}${i}${o}${a}`,n.async=!0,document.body.appendChild(n)}t.next&&t.next.length>0&&t.next.forEach(n=>{addExitScriptTags$1(n)})}function on_mobile_exit_intent(t){if(!isMobile)return;if(mobileExitIntentInitialized)return void console.log("Mobile exit intent already initialized, skipping");mobileExitIntentInitialized=!0,console.log("Initializing mobile exit intent");let n,i,o=0,a=0,r=!1;function d(){const l=scrollState.fastScrollCount>=2,u=scrollState.directionChanges>=MOBILE_EXIT_CONFIG.directionChangeThreshold;!l&&!u||scrollState.isTriggered||(scrollState.isTriggered=!0,scrollState.lastTriggerTime=Date.now(),window.console&&window.console.log&&console.log("Mobile exit intent triggered:",{fastScrollCount:scrollState.fastScrollCount,directionChanges:scrollState.directionChanges,velocity:scrollState.scrollVelocity}),t())}function c(){scrollState.fastScrollCount=0,scrollState.directionChanges=0,scrollState.lastDirection=null,scrollState.scrollVelocity=0}document.addEventListener("touchstart",l=>{o=l.touches[0].clientY,r=!1},{passive:!0}),document.addEventListener("touchmove",l=>{r||(r=!0,a=l.touches[0].clientY)},{passive:!0}),document.addEventListener("touchend",l=>{r&&(a=l.changedTouches[0].clientY,Math.abs(a-o)>MOBILE_EXIT_CONFIG.minScrollDistance&&d())},{passive:!0}),window.addEventListener("scroll",()=>{const l=window.pageYOffset,u=Date.now();if(u-scrollState.lastTriggerTime<MOBILE_EXIT_CONFIG.debounceTime)return;const s=l-scrollState.lastScrollY,p=u-scrollState.lastScrollTime;p>0&&(scrollState.scrollVelocity=Math.abs(s)/p);const g=s>0?"down":"up";scrollState.lastDirection&&scrollState.lastDirection!==g&&scrollState.directionChanges++,scrollState.lastDirection=g,scrollState.lastScrollY=l,scrollState.lastScrollTime=u,scrollState.scrollVelocity>MOBILE_EXIT_CONFIG.fastScrollThreshold&&scrollState.fastScrollCount++,clearTimeout(n),n=setTimeout(()=>{d(),c()},MOBILE_EXIT_CONFIG.velocityTimeWindow)},{passive:!0}),window.addEventListener("orientationchange",()=>{setTimeout(()=>{c(),scrollState.isTriggered=!1},300)}),document.addEventListener("visibilitychange",()=>{document.hidden&&(clearTimeout(i),i=setTimeout(()=>{scrollState.isTriggered=!1},3e4))})}function listen_mobile_exit_intent(t=null){isMobile&&(t||(t=window.page_events.find(n=>n.type=="mobile_exit_intent")),t&&(addExitScriptTags$1(t),on_mobile_exit_intent(function(){processFunnelNode(t.next[0]).then(()=>{})})))}async function processFunnelNode(t,n){return console.log("processFunnelNode",t,n),console.trace(),await processBaseFunnelNode(t,n,[{type:"has_tag",process:(o,a={},r=[])=>{let d=check_cookie(o.data.value);return a.callback&&a.callback("has_tag",d),o=get_next_step(o,d?0:1)}},{type:"add_tag",process:(o,a={},r=[])=>(a.callback&&a.callback("add_tag",o.data.value),set_cookie(`tag_${o.data.value}`,1,null,!0),o=get_next_step(o,0))},{type:"affiliate_whitelisted",process:async(o,a={},r=[])=>{let d=new URLSearchParams(window.location.search).get("aff_id");return get_next_step(o,d&&check_cookie("aff_w_"+d)?0:1)}},{type:"url_redirect",process:async(o,a={},r=[])=>(location.href=o.data.value,null)},{type:"exit_intent",process:async(o,a={},r=[])=>(await listen_exit_intent(o),null)},{type:"mobile_exit_intent",process:async(o,a={},r=[])=>(await listen_mobile_exit_intent(o),null)},{type:"exit_popup",process:async(o,a={},r=[])=>(await show_exit_popup(o.data.value).then(d=>{a.callback&&a.callback("exit_popup",d)}),null)},{type:"video_is_muted",process:async(o,a={},r=[])=>{let d=window.player_is_muted??!1;return window.elasticDetectedVideos?d=window.elasticDetectedVideos.isMuted():window.tp?d=window.tp.isMuted():window.player_is_muted&&(d=window.player_is_muted),o=get_next_step(o,d?0:1)}},{type:"video_pause",process:async(o,a={},r=[])=>{let d=!1;const c=()=>{d||(d=!0,processFunnelNode(o=get_next_step(o,0),a))};if(window.elasticDetectedVideos){const s=window.elasticDetectedVideos.getAll();if(s&&s.length>0)return void s.forEach(p=>{p.element&&p.element.addEventListener&&p.element.addEventListener("pause",c,{once:!0})})}const l=document.querySelectorAll("video");if(l.length>0)return void l.forEach(s=>{s.addEventListener("pause",c,{once:!0})});const u=setInterval(()=>{if(d)return void clearInterval(u);const s=document.querySelectorAll("video");s.length>0&&(clearInterval(u),s.forEach(p=>{p.addEventListener("pause",c,{once:!0})}))},500);setTimeout(()=>clearInterval(u),3e4)}},{type:"video_watched_seconds",process:async(o,a={},r=[])=>{const d=o.data.value?parseInt(o.data.value):null,c=o.data.percent?parseFloat(o.data.percent):null,l=()=>{const s=(()=>{let p=0,g=0;return window.elasticDetectedVideos?(p=window.elasticDetectedVideos.getCurrentTime()||0,g=window.elasticDetectedVideos.getDuration()||0):window.tp?(p=window.tp.getCurrentTime()||0,g=window.video_duration||0):(p=window.current_player_time||0,g=window.video_duration||0),{currentTime:p,duration:g,percent:g>0?p/g*100:0}})();return d!==null&&s.currentTime>=d||c!==null&&s.percent>=c};if(l())return void processFunnelNode(o=get_next_step(o,0),a);const u=setInterval(()=>{l()&&(clearInterval(u),processFunnelNode(o=get_next_step(o,0),a))},500);setTimeout(()=>clearInterval(u),6e5)}},{type:"video_progress_check",process:async(o,a={},r=[])=>{const d=o.data.value?parseInt(o.data.value):null,c=o.data.percent?parseFloat(o.data.percent):null;let l=0,u=0;window.elasticDetectedVideos?(l=window.elasticDetectedVideos.getCurrentTime()||0,u=window.elasticDetectedVideos.getDuration()||0):window.tp?(l=window.tp.getCurrentTime()||0,u=window.video_duration||0):(l=window.current_player_time||0,u=window.video_duration||0);let s=!1;return d!==null&&l>=d&&(s=!0),c!==null&&(u>0?l/u*100:0)>=c&&(s=!0),o=get_next_step(o,s?0:1)}},{type:"on_cta",process:async(o,a={},r=[])=>{console.trace("cta");const d=()=>{window.removeEventListener("video-cta-shown",d),processFunnelNode(o=get_next_step(o,0),a)};window.addEventListener("video-cta-shown",d)}},{type:"when_scrolled_to",process:async(o,a={},r=[])=>{const d=o.data.value?parseFloat(o.data.value):null,c=o.data.percent?parseFloat(o.data.percent):null,l=()=>{const s=window.scrollY||window.pageYOffset||0,p=Math.max(document.body.scrollHeight-window.innerHeight,0);return d!==null&&s>=d||c!==null&&(p>0?s/p*100:0)>=c};if(l())return void processFunnelNode(o=get_next_step(o,0),a);let u=()=>{l()&&(processFunnelNode(o=get_next_step(o,0),a),window.removeEventListener("scroll",u))};window.addEventListener("scroll",u,{passive:!0})}},{type:"showed_cta",process:async(o,a={},r=[])=>(console.log("showed_cta",window.showed_video_cta??!1),o=window.showed_video_cta?get_next_step(o,0):get_next_step(o,1))},{type:"wait_seconds",process:async(o,a={},r=[])=>(console.log("wait-seconds",o.data.value),await new Promise(d=>setTimeout(d,1e3*o.data.value)),get_next_step(o,0))},{type:"show_element",process:async(o,a={},r=[])=>{console.log("show_element",o.data.value);let d=document.querySelector(o.data.value);return d?(d.style.display="block",get_next_step(o,0)):(console.error("Element not found",o.data.value),null)}},{type:"hide_element",process:async(o,a={},r=[])=>{console.log("hide_element",o.data.value);let d=document.querySelector(o.data.value);return d?(d.style.display="none",get_next_step(o,0)):(console.error("Element not found",o.data.value),null)}},{type:"split_test",process:async(o,a={},r=[])=>{let d=o.data.split_test_id;return(o=await determine_split_result(o,a))&&(o.data||(o.data={}),o.data.split_test_id=d),a.req||o&&trigger_split_test_result(o,a),o}},{type:"on-form-success",process:async(o,a={},r=[])=>{document.addEventListener("on-form-success",d=>{d.detail.form.getAttribute("id")==o.data.form&&processFunnelNode(o.next[0]).then(()=>{})})}},{type:"on-add-to-cart",process:async(o,a={},r=[])=>{document.addEventListener("on-add-to-cart",d=>{processFunnelNode(o.next[0]).then(()=>{})})}},{type:"mark_whitelisted",process:async(o,a={},r=[])=>{const d=o.data?.encrypted_cookie_value,c=o.data?.expiration_minutes??0;if(d){let l=null;l=c>0?60*c:31536e4,set_cookie("whtst",d,l,!1)}else console.warn("No encrypted value found in node data");return o=get_next_step(o,0),console.log("next node",o),o}},{type:"mark_not_whitelisted",process:async(o,a={},r=[])=>{const d=o.data?.encrypted_cookie_value;return d&&set_cookie("whtst",d,604800,!1),o=get_next_step(o,0)}},{type:"client_script",process:async(o,a={},r=[])=>{console.trace("cta");let d=document.createElement("script");return d.type="text/javascript",d.text=o.data.client_script,document.body.appendChild(d),o=get_next_step(o,0)}},{type:"sequence",process:async(o,a={},r=[])=>{let d=0,c=get_next_step(o,d);do await processBaseFunnelNode(c,a,r);while(c=get_next_step(o,d++))}},{type:"execute_automation",process:async(o,a={},r=[])=>{const d=o.data?.token;if(!d)return console.warn("[execute_automation] No token found in node data"),get_next_step(o,0);const c={token:d,context:{trigger:"frontend_funnel",time_on_page:window.timeOnPage||0,page_url:window.location.href,pgid:window.pgid,fid:window.fid,fnid:window.fnid,bid:window.bid}};console.log("[execute_automation] Triggering automation");try{if(navigator.sendBeacon){const l=new Blob([JSON.stringify(c)],{type:"application/json"});navigator.sendBeacon("/api/trigger-automation",l)}else fetch("/api/trigger-automation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c),keepalive:!0}).catch(l=>console.error("[execute_automation] Request failed:",l))}catch(l){console.error("[execute_automation] Failed to trigger:",l)}return get_next_step(o,0)}}])}window.mobileExitIntentDeviceChange=function(t){if(console.log("Mobile exit intent handling device change to:",t),mobileExitIntentInitialized=!1,scrollState&&(scrollState.isTriggered=!1,scrollState.fastScrollCount=0,scrollState.directionChanges=0,scrollState.lastDirection=null,scrollState.scrollVelocity=0,scrollState.lastTriggerTime=0),t==="mobilePortrait"){const n=window.page_events?window.page_events.find(i=>i.type=="mobile_exit_intent"):null;n&&(console.log("Reinitializing mobile exit intent for device change"),listen_mobile_exit_intent(n))}},window.processFunnelNode=processFunnelNode;const funnelflow=Object.freeze(Object.defineProperty({__proto__:null,processFunnelNode},Symbol.toStringTag,{value:"Module"}));function addExitScriptTags(t){if(t.type=="exit_popup"){let n=document.createElement("script");const i=window.pgid?`&pg=${window.pgid}`:"",o=window.fid?`&fid=${window.fid}`:"",a=window.fnid?`&fnid=${window.fnid}`:"";n.src=`/ex/${t.data.value}?b=${bid}${i}${o}${a}`,n.async=!0,document.body.appendChild(n)}t.next&&t.next.length>0&&t.next.forEach(n=>{addExitScriptTags(n)})}function on_exit_intent(t){let n;document.querySelector("body").addEventListener("mouseleave",i=>{n=i.clientY,n<0&&t()})}function listen_exit_intent(t=null){t||(t=window.page_events.find(n=>n.type=="exit_intent")),t&&(addExitScriptTags(t),on_exit_intent(function(){processFunnelNode(t.next[0]).then(()=>{})}))}function on_form_success(){document.addEventListener("on-form-success",t=>{let n=t.detail.form;window.page_events.forEach(i=>{i.type==="on-form-success"&&n.getAttribute("id")==i.data.form&&processFunnelNode(i.next[0]).then(()=>{})})})}function listen_on_form_success(){on_form_success()}function listen_page_view(){if(window.__page_view_processed)return;window.__page_view_processed=!0,window.page_events=window.page_events||[];let t=window.page_events.find(n=>n.type=="page_view");t&&t.next.forEach(n=>{processFunnelNode(n).then(()=>{})})}function listen_on_add_to_cart(){window.page_events=window.page_events||[],window.page_events.forEach(t=>{t.type==="on-add-to-cart"&&processFunnelNode(t).then(()=>{})})}function listen_when_scrolled_to(){if(!window.page_events)return;const t=window.page_events.filter(n=>n.type==="when_scrolled_to");t&&t.length!==0&&t.forEach(n=>{processFunnelNode(n)})}function listen_video_watched_seconds(){if(!window.page_events)return;const t=window.page_events.filter(n=>n.type==="video_watched_seconds");t&&t.length!==0&&t.forEach(n=>{processFunnelNode(n)})}function openDebuggerKeyModal(){if(document.getElementById("debug-key-modal-overlay"))return;const t=document.createElement("div");t.id="debug-key-modal-overlay",t.style.position="fixed",t.style.inset="0",t.style.background="rgba(0,0,0,0.45)",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="999999";const n=document.createElement("div");n.style.background="#ffffff",n.style.borderRadius="8px",n.style.boxShadow="0 10px 30px rgba(0,0,0,0.2)",n.style.width="min(90vw, 420px)",n.style.padding="20px",n.style.fontFamily="system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif";const i=document.createElement("div");i.textContent="Enable Debugger",i.style.fontSize="18px",i.style.fontWeight="600",i.style.marginBottom="10px";const o=document.createElement("div");o.textContent="Paste your debug key to enable the debugger for this session.",o.style.fontSize="13px",o.style.color="#444",o.style.marginBottom="14px";const a=document.createElement("input");a.type="text",a.placeholder="Debug key",a.autocomplete="off",a.style.width="100%",a.style.padding="10px 12px",a.style.border="1px solid #d1d5db",a.style.borderRadius="6px",a.style.outline="none",a.style.fontSize="14px",a.style.boxSizing="border-box";try{const s=localStorage.getItem("ef_debug_last_key");s&&(a.value=s)}catch{}const r=document.createElement("div");r.style.color="#b91c1c",r.style.fontSize="12px",r.style.marginTop="6px",r.style.display="none";const d=document.createElement("div");d.style.display="flex",d.style.gap="8px",d.style.marginTop="16px",d.style.justifyContent="flex-end";const c=document.createElement("button");c.textContent="Cancel",c.style.padding="8px 12px",c.style.background="#e5e7eb",c.style.border="1px solid #e5e7eb",c.style.borderRadius="6px",c.style.cursor="pointer",c.onclick=()=>document.body.removeChild(t);const l=document.createElement("button");function u(){const s=(a.value||"").trim();if(!s)return r.textContent="Please enter a debug key.",r.style.display="block",void a.focus();try{localStorage.setItem("ef_debug_last_key",s)}catch{}const p=encodeURIComponent(window.location.href),g=`/debugger?key=${encodeURIComponent(s)}&next=${p}`;window.location.assign(g)}l.textContent="Enable",l.style.padding="8px 12px",l.style.background="#111827",l.style.color="#ffffff",l.style.border="1px solid #111827",l.style.borderRadius="6px",l.style.cursor="pointer",l.onclick=u,a.addEventListener("keydown",s=>{s.key==="Enter"&&u(),s.key==="Escape"&&(s.stopPropagation(),document.body.removeChild(t))}),t.addEventListener("click",s=>{s.target===t&&document.body.removeChild(t)}),d.appendChild(c),d.appendChild(l),n.appendChild(i),n.appendChild(o),n.appendChild(a),n.appendChild(r),n.appendChild(d),t.appendChild(n),document.body.appendChild(t),setTimeout(()=>a.focus(),0)}window.listen_page_view=listen_page_view,(async()=>document.querySelectorAll('[data-dropdown="click"], [data-dropdown="hover"]').length>0&&await __vitePreload(()=>import("./dropdown-eek4IRMA.js"),[]))(),(async()=>document.querySelectorAll('[data-burger="burger"], [data-responsive-menu="burger"]').length>0&&await __vitePreload(()=>import("./responsive-menu-DpMeyJvw.js"),[]))(),(async()=>document.querySelectorAll(".accordion").length>0&&await __vitePreload(()=>import("./accordion-BI7dSoxN.js"),[]))(),(async()=>document.querySelectorAll(".survey").length>0&&await __vitePreload(()=>import("./survey-BhC4TCMu.js"),[]))(),(async()=>document.querySelectorAll(".live-order").length>0&&await __vitePreload(()=>import("./live-order-CpUawYwA.js"),[]))(),(async()=>document.querySelectorAll(".fade-in-viewport").length>0&&await __vitePreload(()=>import("./fade-in-cqSf94AV.js"),[]))(),(async()=>document.querySelectorAll("[data-seconds]").length>0&&await __vitePreload(()=>import("./countdown-FYI8k12M.js"),[]))(),(async()=>document.querySelectorAll('[class*="parallax-"], [data-parallax-effect]').length>0&&await __vitePreload(()=>import("./parallax-DP9F3W88.js"),__vite__mapDeps([0])))(),(async()=>document.querySelectorAll('[data-modal="true"]').length>0&&await __vitePreload(()=>import("./modals-B5FUhfoa.js"),[]))(),(async()=>document.querySelectorAll('[class*="animate-"]').length>0&&await __vitePreload(()=>import("./index-CBePbqM8.js"),__vite__mapDeps([1])))(),(async()=>document.querySelectorAll('[data-sliding-banners="true"]').length>0&&await __vitePreload(()=>import("./sliding-banners-0StMsWGO.js"),[]))(),(async()=>document.querySelectorAll("[data-slider]").length>0&&await __vitePreload(()=>import("./plugin-slider.js"),[]))(),(async()=>(document.querySelectorAll("[data-bump-products], [data-bump-checkbox]").length>0||new URLSearchParams(window.location.search).get("bumps"))&&await __vitePreload(()=>import("./bump-products-B05dLuIc.js"),[]))(),(async()=>document.querySelectorAll(".checkout-personal-details, .checkout-cc-panel, [data-checkout-submit]").length>0&&(await __vitePreload(()=>import("./checkout-DV5hlW64.js"),[]),await __vitePreload(()=>import("./tax-calculator-TN-UrD8G.js"),[]),await __vitePreload(()=>import("./shipping-calculator-CadNAReu.js"),[])))(),(async()=>document.querySelectorAll("#stripe-card-element, #nmi-card-element").length>0&&await __vitePreload(()=>import("./secure-payments-Dvbdbkmk.js"),[]))(),(async()=>document.querySelectorAll("form[data-abandon-track], form.checkout-form, form#checkout-form, .checkout-personal-details, .checkout-cc-panel").length>0&&await __vitePreload(()=>import("./abandon-tracking-Df_BE6gD.js"),[]))(),(async()=>document.querySelectorAll("[data-ai-tag]").length>0&&await __vitePreload(()=>import("./ai-tag-tracking-x9VTBtgB.js"),[]))(),(async()=>document.querySelectorAll("[data-questions], [data-quiz]").length>0&&await __vitePreload(()=>import("./quiz-B-86sjyu.js"),[]))(),(async()=>document.querySelectorAll("[data-tabs]").length>0&&await __vitePreload(()=>import("./plugin-tabs.js"),[]))(),(async()=>document.querySelectorAll("[data-nav-menu]").length>0&&await __vitePreload(()=>import("./plugin-nav-menu.js"),[]))(),(async()=>document.querySelectorAll("[data-comments-feed]").length>0&&await __vitePreload(()=>import("./comments-feed-DCgmtFs_.js"),[]))(),(async()=>window.int&&window.int.some(t=>t.action&&t.action.startsWith("animate-"))&&await __vitePreload(()=>import("./animations-interactions-CQncwCrV.js"),__vite__mapDeps([2])))(),(async()=>document.querySelectorAll("*[data-youtube-code], *[data-direct-link]").length>0&&await __vitePreload(()=>import("./plugin-player.js").then(t=>t.p),[]))(),(async()=>{let t=0,n=setInterval(async()=>{document.querySelectorAll('.trackplay-container, [id^="vidalytics"] video, #smartplayer video, vturb-player, vturb-smartplayer').length>0&&(clearInterval(n),await __vitePreload(()=>import("./video-tracking-DOIbDVV1.js"),[])),t++,t>5&&clearInterval(n)},1e3)})(),listen_page_view(),listen_mobile_exit_intent(),listen_exit_intent(),listen_on_form_success(),listen_on_add_to_cart(),listen_when_scrolled_to(),listen_video_watched_seconds(),document.addEventListener("keydown",async t=>{if((t.ctrlKey||t.metaKey)&&t.shiftKey&&t.key==="F12"){if(t.preventDefault(),window.debug_enabled!==!0)return openDebuggerKeyModal(),!1;window.debugWindow||await __vitePreload(()=>import("./debug-window-DVUibJA0.js"),__vite__mapDeps([3])),window.debugWindow&&window.debugWindow.toggle()}}),(async()=>{try{const t=localStorage.getItem("ef_debug_window_open")==="true",n=new URLSearchParams(window.location.search).get("debugbar")==="true";if((t||n)&&(window.debugWindow||await __vitePreload(()=>import("./debug-window-DVUibJA0.js"),__vite__mapDeps([3])),window.debugWindow&&!window.debugWindow.isOpen&&window.debugWindow.toggle(),n)){const i=new URL(window.location.href);i.searchParams.delete("debugbar"),window.history.replaceState({},document.title,i.toString())}}catch(t){console.warn("Debug window auto-load failed",t)}})(),window.addEventListener("DOMContentLoaded",async()=>{try{const t=new URLSearchParams(window.location.search).get("debugbar")==="true";if((localStorage.getItem("ef_debug_window_open")==="true"||t)&&(window.debugWindow||await __vitePreload(()=>import("./debug-window-DVUibJA0.js"),__vite__mapDeps([3])),window.debugWindow&&!window.debugWindow.isOpen&&window.debugWindow.toggle(),t)){const n=new URL(window.location.href);n.searchParams.delete("debugbar"),window.history.replaceState({},document.title,n.toString())}}catch(t){console.warn("Debug window DOMContentLoaded auto-load failed",t)}});export{addUtmParams as a,funnelflow as f};
